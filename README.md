# Shopbot
Для пользователей.

Бот получает сообщение, содержащее ссылку на  подбор каких-либо товаров на Озоне или Сбермегамаркете и возвращает 5 сообщений с каждой ссылки с самыми дешевыми товарами из подборки и запускает клавиатуру, в которой есть 4 кнопки для сбора информации по кормам Чаппи и Пробаланс на  Озоне и Сбермегамаркете.  Пятая кнопка выводит информацию по ссылкам, которые добавлены в отслеживание. 
У каждого возвращаемого сообщения есть две инлайн-кнопки: " Начать отслеживание" и " Не отслеживать". После нажатия кнопки "Начать отслеживать" ссылка подборки заноситься в список отслеживаемых товаров.
В результате ввода ссылки, которая уже есть в списке отслеживания, у возвращенных сообщений будет две инлайн-кнопки "Продолжить отслеживание" и "Прекратить отслеживание" . В результате нажатия кнопки "Продолжить отслеживание" ссылка останется. Если будет нажата кнопка "Прекратить отслеживание" - ссылка будет удалена. Если в списке отслеживаемых товаров несколько ссылок, то нажимать кнопку "Прекратить отслеживание" надо в течение одной минуты, пока не начался сбор информации по другой ссылке из списка. Иначе будет удалена ссылка на подборку товаров,  по которой начался сбор информации.
Кнопки прикрепленные у сообщениям (инлайн-кнопки) действуют на общую ссылку 
по сбору информации, а не на конкретный товар. 
В результате нажатия репли-кнопки "Включить отслеживание" будет производится сбор информации по ссылкам, находящихся в соответствующем файле два раза в сутки.

Функции
Shopbot
Send_message()
Получает сообщения и отвечает на них, вызывая соответствующие. Создает репли-кнопки.

autostatrt()
Запускается передачей сообщения " старт" .  Функция в цикле while ждет True от timer(),  собирает данные о файлах в корневом каталоге. Если есть файлы, начинающиеся с  monitor_ref, то функция добавляет имя файла в список list_files,  проверяет значение True, забирает message . Далее функция вызывает в цикле for l_ref(), получает отслеживаемые ссылки и вызывает  sbor_ozon_sber(). 

monitor_data()
 Запускается передачей сообщения " сбор данных".  Функция  запускает l_ref(), проверяя, что в файл есть ссылки. Если ссылки есть, забираем message из файла monitor_ref и подменяем ссылку на ссылки из файла monito_list_ref  и вызывает sbor_ozon_sber(), передавая ему модифицированный  message.  Затем вызывает паузу 60 с. для того чтобы было время нажать инлайн-кнопки.

sbor_ozon_sber()
Получает словарь message, создает две инлай-клавиатуры, которые выводятся сообщениями результатов сбора информации в зависимости от того есть ли ссылка в списке отслеживания или нет. В зависимости от какая ссылка пришла в message вызывается соответствующий парсер ozon или SberMM, которые возвращают списки собранных и отсортированных товаров. Далее эти списки отправляются в сообщениях тому пользователю, от которого пришел запрос.

l_ref()
Функция  получает user id и и открывает соответствующий файл со списками ссылок. Функция возвращает список ссылок.
add_l_ref()
Функция получает callback. Открывает файл monitor_list_ref...id соответствующего пользователя, получая id из callback, проверяет  нет ли переданной  ссылки в файле и, если нет, добавляет в файл.

del_l_ref()
Функция получает id пользователя. Открывает соответствующий файл с ссылками. Берет ссылку из глобальной переменной mess_ref и удаляет ее списка.

start_tracking()
Функция ждет callback сообщений. При получении 'start_inl'  вызывает add_l_ref(), записывает True и mess_ref в monitor_ref.
При получении 'no_inline'  выводит callback answer 'Ну нет, так нет'.
При получении "finish_inline"  вызывается del_l_ref().
При получении 'no_inline2' выводит callback answer "Все по-прежнему".

timer()
Функция получает время типа "строка",  сравнивает текущее время с переданным временем и возвращfет True, если время находится диапазоне близком заданному.
